**mysql的数据文件格式及存储路径**
- **数据存储文件**
    - **数据文件：** 存储实际的数据和索引
        - **文件格式：**
          - **.frm：** 保存了表结构的定义信息
          - **.ibd：** 保存了数据库表数据和索引
        - **文件路径**（InnoDB引擎）
            - **Linux:**`/var/lib/mysql/database_name/table_name.ibd`（可以通过my.cnf文件查看文件路径）
            - **Windows:**`..\MySQL\MySQL Server\Data\database_name`

**mysql的日志文件保存在哪里，里面记录了什么内容**

- **错误日志：** 记录mysql启动、运行、停止时遇到的问题。如：启动错误、用法错误
    - **路径：** /var/log/mysqld.log
- **查询日志：** 记录DDL、DML等语句，用于分析查询性能和调试问题，对于高负载系统，开启查询日志可能对性能产生影响
    - **路径：** 在/etc/my.cnf 中添加 `general_log=1`和`general_log_file='querylog_dir'`

- **慢查询日志：** 记录所有执行时间超出long_query_time秒的所有查询和不使用索引的查询语句，用于优化sql语句
    - **路径：** /var/lib/mysql/localhost-slow.log
    ```
    show variables like '%query%';(查看慢查询的状态信息)
    set global slow_query_log=on;(打开慢查询)
    set global long_query_time=1;(设置超时时长)
    ```
- **二进制日志：** 记录所有更改数据库的语句，不记录`select`、`show`等不涉及修改的操作，还用于复制、数据恢复等
  - **路径：** /var/lib/mysql（使用mysqlbinlog命令进行查看）
- **重做日志（Redo log）：** 记录正在进行的事务更改的操作，支持崩溃恢复
  - **路径：** /var/lib/mysql/#innodb_redo

**如何备份数据库，什么是逻辑备份和物理备份，分别使用什么工具**
- **备份数据**
  - **数据库：**`mysqldump -u username -p database_name > backup.sql`
  - **特定表：**`mysqldump -u username -p database_name table_name > table_backup.sql`
- **备份**
  - **逻辑备份：** 将数据库的逻辑结构进行备份（如：DDL、DML语句等），该方法相对较慢，但在跨平台、跨版本场景下兼容性良好
    - **工具：**mysqldump
  - **物理备份：** 将数据库文件直接进行复制备份（如：数据文件、日志文件），该方法快速但不够灵活，兼容性不好，只能在相同mysql版本下进行恢复
    - **工具：** 打包数据库文件、xtrabackup

**什么是热备份和冷备份，什么是全量备份和增量备份**
- **冷备份：** 脱机备份，在关闭数据库时进行
- **热备份：** 联机备份，数据库处于运行状态，依赖数据库的日志文件
- **全量备份：** 对数据库进行完整备份
- **增量备份：** 在上一次完成的全量备份的基础上备份被修改的文件

**如何还原数据库，将备份数据还原至其他机器**
- **打包数据库**
  - **备份：**
    - 关闭数据库
    - 切换至/var/lib/mysql
    - 键入`tar -zcf file_name.tar.gz /var/lib/mysql`
  - **还原：**
    -  解压tar包
    -  将文件重新放回mysql的datadir中

- **mysqldump**
  - **备份：**
    - 键入`mysqldump -u username -p database_name > backup.sql`
  - **还原：**
    - 键入``mysqldump -u username -p database_name < backup.sql``

**如何搭建主从复制，实现原理是什么**
- **原理：** master在进行事务提交时会将数据的变更记录记录在binlog中，slave建立io线程去读取master的binlog文件，io线程将日志文件写入relay log中，slave通过自身的sql线程去读去relay log中的sql语句完成对master数据的复制

**除主从复制为还有什么方式，各有什么优缺点**
- **一主多从：** 适合大量读少量写的情况，能够有效减轻主数据库的压力，但当从数据库数量多时，也会该主数据库带来不确定性 
- **级联复制：** 主数据库不再与大量从数据库建立联系，而专注于和自己关联的少量从数据库，有效的缓解了主数据库的压力，但由于数据库之间的关系变得更复杂，问题也更易出现
- **主主复制：** 客户端对任意一个主数据库进行更改，数据变化都会同步到另一台主数据库中，在一个数据库出现问题时，服务并不会终止。但当复制停止后，客户端仍然对两个主数据库进行数据更新，但此时数据不互通了，后续的数据同步会非常麻烦 

**主数据库与从数据库各自的主要职责是什么**
- **主数据库：** 主要负责数据的修改更新等操作
- **从数据库：** 主要负责查询操作，在主数据库出现问题时能充当临时数据库，保证服务不中断

**什么是数据库的读写分离，为什么要读写分离**
- **读写分离：** 将对数据的读操作放在从数据库中，将写操作放在主数据库中，减轻主服务器的压力，提高系统的稳定性
- **为什么进行读写分离：** 采用读写分离将读操作放在从数据库上能有效减轻主数据库的压力，在主数据库出现问题时，可以使用从数据库充当临时数据库从而保证服务的可用

**如何判断主从是否延迟，如何进行延迟监控与处理**
- **判断主从延迟：**`show slave status`,查看seconds_behind_master,如果是null则代表主从连接可能出现了问题，如果是0则代表没有延迟，如果是正数则代表出现延迟
- **监控：** 通过配置主从的慢查询，在慢查询中比较sql语句的执行时间或者使用第三方工具进行监控如zabbix
- **处理：** 可以提升硬件的配置、优化网络、将大事务分解为小事务

**主从复制中断了怎么办，如何进行手动修复**
- **中断：** 
  - 在从库上执行show slave status 查看断开的原因，记录当前的复制点
  - 查看错误日志，分析错误日志
- **解决办法：**
  - 跳过当前事务
  - 使用binlog日志恢复从数据库的数据，确保数据的一致性 

**如何配置GTID模式的复制，与传统复制有何不同**

- **不同：** 传统复制采用的是复制点进行复制，而gtid则是采用事务id进行的，从库将执行过的事务id告知主库，主库将未执行过的事务id返回给从库，确保同一个事务只在从库中执行一次

**什么是延迟从库，为什么要配置延迟从库**
- **延迟从库：** 延迟从库就是指从数据库对于更新主数据库的数据延迟一段时间再执行
- **为什么配置延迟从库：** 相较于一般的主从分离，延迟从库能在主数据库执行重大错误操作时提供容错，如：业务人员在主数据库中执行了drop等操作，但该操作属于误操作，但数据库配置了延迟从库，延迟时间为3小时，那么业务人员就可以在从数据库找到误删的数据，完成补救

**在读写分离中如何确保读操作不会读到未提交的旧数据**
- 采用同步复制，主库在提交一个事务时必须等待所有从库全部执行完事务返回commit后才向客户端返回成功
- 对于有要求的数据直接在主库中读取
- 调整事务隔离机制

**mysql Binlog有哪几种格式，对比优缺点**
- **statement(基于语句)：** 只记录对数据进行修改了的sql语句，该格式的binlog日志量小
- **row(基于行)：** 只记录被修改的行，该格式的binlog日志非常完整，记录了所有数据的变动。带来的缺点就是日志量非常多
- **mixed(statement和row的结合)：** 如update、alter table等语句采用statement格式记录，对数据进行修改的如delete采用row格式进行记录

**mysql各种日志（binlog、redolog、undolog、error log、slow log）的作用与区别是什么**
- **binlog：** 记录数据库中所有的更改操作（DDL、DML），用于数据的复制和恢复，用于主从方案
- **redolog：** 记录事务更改，确保系统崩溃后也能恢复未提交的事务，故障恢复时，可以将已提交但未保存的事务再次保存
- **undolog：** 记录事务操作前的数据，以便回滚时恢复到原始状态，故障恢复时可以使用undo log回滚未提交的事务，确保数据的一致性
- **error log：** 记录mysql启动、运行、停止时遇到的问题。如：启动错误、用法错误
- **slow log：** 记录所有执行时间超出long_query_time秒的所有查询和不使用索引的查询语句，用于优化sql语句

**常见的主从复制框架有哪些，如何设计高可用方案**
- **主主复制：** 客户端对任意一个主数据库进行更改，数据变化都会同步到另一台主数据库中，在一个数据库出现问题时，服务并不会终止。但当复制停止后，客户端仍然对两个主数据库进行数据更新，但此时数据不互通了，后续的数据同步会非常麻烦 
- **半同步复制：** 半同步复制中主库只需要一个从库提交就可以给客户端返回成功，如果超过默认时间仍然没有从库提交，就会切换为异步模式再提交


