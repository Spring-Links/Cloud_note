**Pod结构**
```
-- Pod结构
用户容器1
用户容器2
用户容器3
Pause容器（根容器）
```
- 每个Pod中可以包含一个或多个容器，这些容器分为==两类==
  - 用户容器（数量可多可少）
  - Pause容器（一个根容器）
    - 以根容器为依据评估Pod的健康状态
    - 在根容器上设置ip地址，实现pod内部的网络通信
      - `这里的通信是pod内部通信，采用虚拟二层网络技术实现，网络插件如：Flannel`

****

**Pod定义**
```
-- 查看资源属性
kubectl explain pod   # 查看一级属性
kubectl explain pod.metadata   # 查看二级属性

-- 一级属性
apiVersion <string> 版本，由k8s内部定义，版本号必须可以用kubectl api-versions查询到
kind <string> 类型，由k8s内部定义，版本号必须可以用kubectl api-resources查询到
metadata <object> 元数据，主要是资源标识和说明，常用有name、namespace、labels
spec <object> 描述，配置的重要部分，对各种资源配置的描述
status <object> 状态信息，该内容不需要定义，由k8s自动生成
```

- **spec的子属性**
  - `containers <object>`容器列表，定义容器的详细信息
  - `nodeName <string>`将pod调度到指定的节点
  - `nodeSelector <map>`根据NodeSelector中定义的信息选择将该pod调度到包含这些label的Node上
  - `hostNetwork <boolean>`是否使用主机模式，默认false
  - `volumes <object>`存储卷，定义pod上面挂载的存储信息
  - `restartPolicy <string>`重启策略，当pod遇到故障时的处理策略

****

**Pod配置**
```
container配置介绍
kubectl explain pod.spec.containers

KIND: Pod
VERSION: v1
RESOURCE: containers <object>   # 数组，可以有多个容器
FIELDS:
  name <string>   # 容器名称
  image <string>  # 容器需要的镜像地址
  imagePullPolicy <string>   # 镜像拉取策略
  command <string>   # 容器的启动命令列表，不指定使用打包时使用的启动命令
  args <string>      # 容器的启动命令需要的参数列表
  env <object>       # 容器的环境变量配置
  ports              # 容器需要暴露的端口列表
  resources <object> # 资源限制和资源请求设置
```


- **基本配置**
```
示例：
apiVersion: v1
kind: Pod
metadata:
  name: pod-base
  namespace: dev
  labels:
    user: root
spec:
  containers:
  - name: nginx
    image: nginx:1.17.1
  - name: busybox
    image: busybox:1.30


-- 创建Pod
kubectl apply -f pod-base.yaml

-- 查看Pod状态
kubectl get pod -n dev

-- 查看详细信息
kubectl describe pod pod-base -n dev
```


- **镜像拉取**
```
示例：
apiVersion: v1
kind: Pod
metadata:
  name: pod-base
  namespace: dev
  labels:
    user: root
spec:
  containers:
  - name: nginx
    image: nginx:1.17.1
    imagePullPolicy: Always   # 拉取镜像策略
  - name: busybox
    image: busybox:1.30


-- 拉取策略
1. Always：总是从远程仓库拉取
2. IfNotPresent：先使用本地仓库，如果没有就从远程仓库拉取
3. Never：只使用本地仓库

默认值说明：
  如果镜像tag为具体版本号，默认策略是：IfNotPresent
  如果镜像tag为latest（最终版本），默认策略是：Always
```


- **启动命令**
```
示例：
apiVersion: v1
kind: Pod
metadata:
  name: pod-command
  namespace: dev
spec:
  containers:
  - name: nginx
    image: nginx:1.17.1
  - name: busybox
    image: busybox:1.30
    command: ["/bin/sh","-c","touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) >> /tmp/hello.txt; sleep 3; done;"]


-- 创建Pod
kubectl create -f pod-command.yaml

-- 查看Pod状态
kubectl get pods pod-command -n dev

-- 进入pod中的busybox容器查看文件内容
kubectl exec pod-command -n dev -it -c busybox /bin/sh
# -it：进入容器
# -c：指定容器
```


- **环境变量**
```
示例：
apiVersion: v1
kind: Pod
metadata:
  name: pod-env
  namespace: dev
spec:
  containers:
  - name: busybox
    image: busybox:1.30
    conmmand: ["/bin/sh","-c","while true;do /bin/echo $(date +%T);sleep 60; done;"]
    env:
    - name:"username"
      value: "admin"
    - name: "password"
      value: "123456"


-- 创建Pod
kubectl create -f pod-env.yaml

-- 进入容器
kubectl exec pod-env -n dev -c busybox -it /bin/sh

-- 在容器中测试变量是否被添加
echo $username
echo $password

!!! 这种方法并不推荐，推荐将配置单独存储在配置文件中
```


- **端口设置**
```
ports属性介绍
kubectl explain pod.spec.containers.ports

KIND: Pod
VERSION: v1
RESOURCE: ports <object>
FIELDS:
  name <string>   #端口名称，如果指定必须保证name在pod中是唯一的
  containerPort <integer>   # 容器要监听的端口
  hostPort <integer>   # 容器要在主机上公开的端口，如果设置则主机只能运行一个容器副本
  hostIP <string>      # 要将外部端口绑定到的主机ip（一般省略）
  protocol <string>    # 端口协议，必须是UDP、TCP、SCTP，默认是TCP
```

```
示例：
apiVersion: v1
kind: Pod
metadata:
  name: pod-ports
  namespace: dev
spec:
  containers:
  - name: nginx
    image: nginx:1.17.1
    ports:
    - name: nginx-port
      containerPort: 80
      protocol: TCP


-- 创建Pod
kubectl create -f pod.ports.yaml

-- 查看pod
kubectl get pod pod-ports -n dev -o yaml
```


- **资源配额**
```
示例：
apiVersion: v1
kind: Pod
metadata:
  name: pod-resources
  namespace: dev
spec:
  containers:
  - name: nginx
    mage: nginx:
    resources:
      limits:
        cpu: "2"
        memory: "10Gi"
    requests:
      cpu: "1"
      memory: "10Mi"


1. limits：限制运行时容器能占用的最大资源，当容器占用资源超过limits时会被终止并重启
2. requests：用于设置占用最小资源，环境资源不足则该容器无法启动
3. cpu：core数，可以是整数或小数 
4. memory：内存大小，可以使用Gi、Mi、G、M

-- 运行Pod
kubectl create -f pod-resources.yaml

-- 查看Pod状态
kubectl get pod pod-resources -n dev

当STATUS为Pending时表示该Pod未正常启动，而是被挂起了
当使用describe查看pod状态时，出现`Insufficient memory`表示内存不足
```